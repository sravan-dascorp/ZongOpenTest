using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class OpenTestSceneController : MonoBehaviour
{

    //Rabbit
    [SerializeField] GameObject rabbit;  
    


    public Transform[] waypoints;
    public Transform player;
    public float playerDetectionDistance = 10f;
    public float idleDistance = 15f;
    public float movementSpeed = 3f;

    private int currentWaypointIndex = 0;
    private Coroutine rabbitCoroutine;

    void Start()
    {
       
    }



    public void SpawnRabbit()
    {
         rabbitCoroutine = StartCoroutine(RabbitRoutine());
    }


    IEnumerator RabbitRoutine()
    {
        while (currentWaypointIndex < waypoints.Length)
        {
            float distanceToPlayer = Vector3.Distance(transform.position, player.position);

            if (distanceToPlayer < playerDetectionDistance)
            {
                MoveTowardsWaypoint();

                if (distanceToPlayer < idleDistance)
                {
                    
                    Idle();
                    while (distanceToPlayer < idleDistance)
                    {
                        yield return null;
                        distanceToPlayer = Vector3.Distance(transform.position, player.position);
                    }
                }
            }
            else
            {
                Idle();
            }

            if (Vector3.Distance(transform.position, waypoints[currentWaypointIndex].position) < 0.5f)
            {
               currentWaypointIndex++;
            }

            yield return null;
        }

      
        gameObject.SetActive(false);
    }

    void MoveTowardsWaypoint()
    {
        transform.position = Vector3.MoveTowards(transform.position, waypoints[currentWaypointIndex].position, movementSpeed * Time.deltaTime);
    }

    void Idle()
    {
        
    }

   
}
